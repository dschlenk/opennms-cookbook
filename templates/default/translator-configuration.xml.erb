<?xml version="1.0" encoding="UTF-8"?>
<event-translator-configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://xmlns.opennms.org/xsd/translator-configuration http://www.opennms.org/xsd/config/translator-configuration.xsd ">
<%
def value_to_xml_str(value, level)
  xml = ""
  indent = "  " * level

  if value.is_a?(Array)
    value.each do |val|
      xml += "#{indent}<value>\n"
      xml += value_to_xml_str(val, level + 1)
      xml += "#{indent}</value>\n"
    end
  else
    xml += "#{indent}<value>#{value}</value>\n"
  end

  xml
end
%>  
  <translation>
    <% @config.each do |spec| -%>
    <event-translation-spec uei=<%= spec.uei.encode(:xml => :attr) %>>
      <mappings>
      <% spec.mappings.each do |mapping| -%>
        <mapping>
        <% mapping.assignments.each do |assignment| -%>
          <assignment name=<%= assignment.name.encode(:xml => :attr) %> type=<%= assignment.name.encode(:xml => attr) %><%= assignment.default.nil? ? '' : " default=#{assignment.default.encode(:xml => :attr)}" %>>
          <% unless assignment.value.nil? -%>
            <value type="constant" result="uei.opennms.org/translator/traps/SNMP_Link_Down">
              <value type="field" name="nodeid" matches=".*" result="${0}" />
              <value type="parameter" name="~^\.1\.3\.6\.1\.2\.1\.2\.2\.1\.1\.([0-9]*)$" matches=".*" result="${0}" />
            </value>
          <% end -%>
          </assignment>
        <% end unless mapping.assignments.nil? -%>
      </mappings>
      <% end unless spec.mappings.nil? -%>
    </event-translation-spec>
    <% end unless @config.specs.nil? -%>
  </translation>

</event-translator-configuration>
